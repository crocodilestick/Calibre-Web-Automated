# **Version 3.2.0** - The Enterprise & Automation Update üè¢ü§ñ‚ú®

> "This update represents a massive leap forward for Calibre-Web Automated. We've moved beyond just 'automating' tasks to creating a robust, enterprise-grade platform that can handle everything from complex authentication flows to intelligent metadata management. With a completely rewritten authentication system, a new powerful task scheduler, and deep Kobo integration, CWA is now more powerful, stable, and flexible than ever before." - CrocodileStick

# Release V3.2.0 Changelog

# Major Changes üöÄ

## **NEW:** Enterprise-Grade Authentication System üõ°Ô∏èüîê

- **Complete Authentication Overhaul:** The entire authentication system has been rewritten from the ground up to meet enterprise security standards, achieving a **92.9% security score** in our internal audits!
- **Auto-User Creation for LDAP & Reverse Proxy:**
    - **LDAP:** Seamlessly integrate with Active Directory, OpenLDAP, and FreeIPA. New users can now be automatically provisioned upon their first login!
    - **Reverse Proxy:** Support for Authelia, Authentik, and Traefik ForwardAuth with configurable auto-creation of users.
- **OAuth Enhancements:**
    - **Redirect Host Configuration:** Solves the "invalid redirect URI" issues for users behind complex proxy setups (Fixes #663).
    - **Permission Inheritance:** OAuth users now correctly inherit all default permissions and settings defined in the Basic Configuration (Fixes #660).
    - **Generic OIDC Support:** Connect to any OpenID Connect provider with ease!
- **Security First:** Enhanced input validation, SQL injection protection, and comprehensive audit logging ensure your library stays safe.

## **NEW:** Next-Level Automation & Scheduling ü§ñ‚è∞

- **Internal Task Scheduler:** A brand new, robust internal scheduler now manages background tasks, ensuring reliability even across container restarts.
- **Auto-Send to eReader:**
    - **Fully Automated:** Newly ingested books can now be automatically emailed to your device!
    - **Configurable Delay:** Set a delay (1-60 minutes) to allow for metadata polishing before sending.
    - **Smart Integration:** Works seamlessly with the new ingest pipeline.
- **Smart Metadata Application:**
    - **Intelligent Replacement:** No more blindly overwriting good data! The new "Smart Mode" only replaces metadata if the new data is objectively better (e.g., higher resolution cover, longer description).
    - **Provider Hierarchy:** Drag-and-drop to prioritize your favorite metadata sources (Google Books, Kobo, etc.).
- **Toast Notifications:** Get real-time feedback on your scheduled jobs with beautiful new toast notifications in the UI.

## **NEW:** The Ultimate Kobo Experience üìöüíú

- **KOReader Progress Syncing:**
    - **Native Sync:** Sync your reading progress from KOReader directly to CWA without needing a separate sync server!
    - **Book Identification:** Uses MD5 hashing for accurate book matching.
- **Annotation Syncing:**
    - **Two-Way Sync:** Your highlights and notes are now synced between your Kobo device and CWA!
    - **Hardcover Integration:** Sync your annotations directly to [Hardcover.app](https://hardcover.app/) (Thanks to **[wolffshots](https://github.com/wolffshots)**!).
- **KFX & KFX-ZIP Support:** Full support for importing and converting to the high-quality KFX format (Thanks to **[jgoguen](https://github.com/jgoguen)**!).
- **Dual-Format Thumbnails:** Automatically generates both WebP (for the web) and JPEG (for Kobo) covers, ensuring covers always show up correctly on your device.

## **NEW:** Bulletproof Ingest & File Management üìÇüõ°Ô∏è

- **Robust Ingest Processor:**
    - **Process Recovery Service:** A new startup service cleans up stale locks and orphaned processes, ensuring the ingest loop never gets stuck.
    - **Lock Mechanism:** Completely rewritten file locking prevents race conditions and "Failed to queue" errors.
- **Configurable Duplicate Detection:**
    - **You Decide:** Configure exactly what constitutes a "duplicate" in your library (Title, Author, Language, etc.).
    - **Language Aware:** Books in different languages are no longer incorrectly flagged as duplicates.
- **Retained Formats:**
    - **Keep the Originals:** You can now choose to keep original file formats after conversion (e.g., keep the EPUB even after converting to KEPUB).
- **Upload to Ingest:** Uploaded files now go through the safe ingest pipeline, ensuring they are properly processed, validated, and deduplicated.

## **NEW:** UI Polish & Performance üé®‚ö°

- **Profile Pictures:**
    - **Live Preview:** See how your new avatar looks before saving.
    - **Auto-Resize:** Client-side resizing ensures fast uploads and optimal performance.
- **Thumbnail System 2.0:**
    - **Always-Active:** Thumbnails are now a core feature, not an option.
    - **WebP Optimization:** Converted all background images and thumbnails to WebP, reducing page weight by **97%**!
- **Performance Optimizations:**
    - **Large Libraries:** Major refactors to "Advanced Search" and "Hot Books" queries make browsing large libraries snappy and responsive.
    - **Lazy Loading:** Improved lazy loading for covers makes scrolling smooth.
- **Quick Actions:**
    - **Hover Menu:** Mark books as read, send to eReader, or edit metadata directly from the book card hover menu!
    - **Shift-Click Selection:** Bulk select books in the list view with standard Shift-Click functionality.

## **NEW:** Stability & Testing üß™üèóÔ∏è

- **Comprehensive Test Suite:** We've added over 130 automated tests covering everything from unit logic to full Docker integration. This ensures that new updates don't break existing features.
- **Python 3.13 Upgrade:** The base image has been upgraded to Python 3.13, future-proofing the application and improving performance.

# Minor Changes ‚ú®

- **Custom Email Subjects:** Users can now customize the subject line for "Send to eReader" emails (Thanks to **[marauder37](https://github.com/marauder37)**!).
- **Kobo Metadata Provider:** Added Kobo as a first-class metadata source (Thanks to **[opswhisperer](https://github.com/opswhisperer)**!).
- **LitRes Provider:** Added support for LitRes metadata (Thanks to **[nstwfdev](https://github.com/nstwfdev)**!).
- **LSOF Upgrade:** Updated `lsof` to prevent hangs on systems with high file descriptor limits.
- **Port Override:** New `CWA_PORT_OVERRIDE` environment variable for easier networking setup.
- **Documentation:** Massive updates to the Wiki, including guides for OAuth, LDAP, and Testing.

# Bugfixes üêõ

- **Amazon Search Fixed:** Resolved recurring issues with Amazon metadata search returning 503 errors (Thanks to **[jgoguen](https://github.com/jgoguen)**!).
- **Ingest Locks:** Fixed the "Failed to queue upload" error caused by broken lock files.
- **Reverse Proxy Session Expiry:** Fixed an issue where sessions would expire every 3 minutes behind a reverse proxy.
- **Google Drive Sync:** Fixed ingest failures when Google Drive sync was disabled.
- **ACSM Ingest:** Fixed issues with importing ACSM files.
- **PDF to EPUB:** Fixed filename issues during conversion.
- **Dark Mode:** Fixed numerous styling issues in Dark Mode, including checkbox visibility and mobile layouts.

# Translations üåç

- **New:** Russian (ru) translations added! (Thanks to **[nstwfdev](https://github.com/nstwfdev)**!)
- **Updated:**
    - Spanish (es) (Thanks to **[avisclair](https://github.com/avisclair)** & **[ivantrejo41](https://github.com/ivantrejo41)**)
    - Italian (it) (Thanks to **[stewie83](https://github.com/stewie83)** & **[edxhub](https://github.com/edxhub)**)
    - French (fr) (Thanks to **[Valenth](https://github.com/Valenth)**, **[deadbone](https://github.com/deadbone)** & **[TexGG](https://github.com/TexGG)**)
    - German (de) (Thanks to **[marodeur80](https://github.com/marodeur80)** & **[Strubbl](https://github.com/Strubbl)**)
    - Hungarian (hu) (Thanks to **[ugyes](https://github.com/ugyes)**)
    - Korean (ko) (Thanks to **[a-eukarya](https://github.com/a-eukarya)**)
    - Portuguese (Brazil) (pt-BR) (Thanks to **[alexantao](https://github.com/alexantao)**)
    - Chinese (zh)

# Thanks to our Contributors! üôè

This release was a massive community effort. A huge thank you to everyone who contributed code, translations, and testing!

- **@angelicadvocate** for Profile Pictures & Retained Formats
- **@opswhisperer** for Kobo Metadata & K8s examples
- **@sirwolfgang** for KOReader Sync
- **@wolffshots** for Hardcover Annotation Sync
- **@jgoguen** for Amazon fixes, KFX support, and Local Build tools
- **@domoel** for Two-way deletion sync
- **@natabat** for Ingest on Upload
- **@marauder37** for Custom Email Subjects
- **@nstwfdev** for Russian translations & LitRes
- **@stadler-pascal**, **@PulsarFTW**, **@DoubleUynn**, **@Flying-Tom**, **@stefanop1**, **@emmanuel-ferdman**, **@werdeil**, **@insideTheVoid**, **@aymendje**, **@kevpam**, **@rjaakke**, **@smathev**, **@tomried**, **@itsmarcy**, **@w1ll1am23**, **@lazyusername**, **@AlexSat**

## Supporting the Project ‚ù§Ô∏è

If CWA makes your library life easier and you‚Äôre in a position to support development, tips are appreciated and go straight back into testing hardware and tooling:

[Support on Ko‚Äëfi](https://ko-fi.com/crocodilestick/tip)
