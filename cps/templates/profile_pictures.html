{% extends "layout.html" %}

{% block header %}
<style>
  .lead-line {
    font-weight: bold;
    text-align: center;
    margin-top: 3rem;
    margin-bottom: 2.5rem;
  }

  .pp-content {
    background-color: #1f2c3554;
    width: -webkit-fill-available;
    max-width: 80rem;
    justify-self: anchor-center;
    padding: 30px;
    margin: 2rem auto 0;
  }

  .pp-buttons {
    display: flex;
    justify-content: space-between;
    margin-left: 1.5rem;
    margin-right: 1.5rem;
    flex-wrap: wrap;
    flex-direction: column;
  }

  #preview {
    display: none;
    border-radius: 50%;
    object-fit: cover;
    width: 200px;
    height: 200px;
    margin-top: 1rem;
    margin-bottom: 2rem;
  }

</style>
{% endblock %}

{% block body %}
<div class="discover">
  <h2>{{title}}</h2>

  <div class="pp-content">
    <h2 class="lead-line">Profile Picture Upload</h2>

    <p style="padding:2rem;">
      Type in the username for the profile picture you would like to change and select an image to upload.
    </p>

    <form method="POST" action="{{ url_for('profile_pictures.set_profile_picture') }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <div class="form-group">
        <label for="username">Username:</label>
        <input type="text" class="form-control" id="username" name="username" required>
      </div>

      <div class="form-group mt-3">
        <label for="image_file">Profile Image:</label>
        <input type="file" id="image_file" accept="image/png, image/jpeg" required>
        <small class="form-text text-muted">Upload a small square PNG or JPG image.</small>
      </div>

      <input type="hidden" id="image_data" name="image_data">

      <img id="preview" src="#" alt="Preview" />

      <div class="pp-buttons mt-4">
        <a class="btn btn-default" href="{{ url_for('admin.admin') }}">Back to Admin Page</a>
        <button type="submit" class="btn btn-primary mt-4">Submit</button>
      </div>
    </form>
  </div>
</div>

<script>
  document.getElementById('image_file').addEventListener('change', function (event) {
    const file = event.target.files[0];
    if (!file) return;

    const preview = document.getElementById('preview');
    const reader = new FileReader();

    reader.onload = function (e) {
      const base64Data = e.target.result;
      preview.src = base64Data;
      preview.style.display = 'block';
      document.getElementById('image_data').value = base64Data;
    };

    reader.readAsDataURL(file);
  });
</script>
{% endblock %}
<!--
  This template is for the profile picture upload page in Calibre-Web Automated.
  NOTE: Images selected here are automatically converted to Base64 and saved in /config/user_profiles.json.
-->