{% extends "layout.html" %}

{% block header %}
<style>
  .kosync-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
  }

  .kosync-section {
    margin-bottom: 30px;
    padding: 20px;
    background-color: var(--color-bg-light);
    border-radius: 8px;
    border: 1px solid var(--color-border);
  }

  .kosync-download-btn {
    display: inline-block;
    padding: 12px 24px;
    background-color: var(--color-secondary);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-weight: bold;
    font-size: 16px;
    text-align: center;
    margin: 10px 0;
    transition: background-color 0.3s;
  }

  .kosync-download-btn:hover {
    background-color: var(--color-secondary-hover);
    color: white;
    text-decoration: none;
  }

  .kosync-step {
    margin-bottom: 15px;
    padding: 15px;
    background-color: var(--color-bg);
    border-left: 4px solid var(--color-secondary);
    border-radius: 4px;
  }

  .kosync-step-number {
    font-weight: bold;
    color: var(--color-secondary);
    margin-right: 10px;
  }

  .kosync-code {
    background-color: var(--color-bg-dark);
    padding: 8px 12px;
    border-radius: 4px;
    font-family: monospace;
    color: var(--color-text);
    display: inline-block;
    margin: 5px 0;
  }

  .kosync-warning {
    background-color: #fff3cd;
    color: #856404;
    padding: 12px;
    border-radius: 4px;
    border: 1px solid #ffeaa7;
    margin: 15px 0;
  }

  .kosync-info {
    background-color: #d1ecf1;
    color: #0c5460;
    padding: 12px;
    border-radius: 4px;
    border: 1px solid #b8daff;
    margin: 15px 0;
  }
</style>
{% endblock %}

{% block body %}
<div class="discover">
  <div class="kosync-container">
    <h2>{{title}}</h2>

    <div class="kosync-section">
      <h3>üì± KOReader Sync Plugin</h3>
      <p>
        This plugin allows you to synchronize your reading progress across multiple devices using KOReader.
        Your progress will be automatically saved and synced with this Calibre-Web-Automated server.
      </p>

      <div class="kosync-info">
        <strong>Compatible with:</strong> KOReader on Android, iOS, Kindle, Kobo, and other supported devices
      </div>

      <div class="text-center">
        <a href="{{ url_for('static', filename='cwasync.koplugin.zip') }}" class="kosync-download-btn">
          üì• Download CWA Sync Plugin
        </a>
      </div>
    </div>

    <div class="kosync-section">
      <h3>üîß Installation Instructions</h3>

      <div class="kosync-step">
        <span class="kosync-step-number">Step 1:</span>
        Download the plugin file <span class="kosync-code">cwasync.koplugin.zip</span> using the button above.
      </div>

      <div class="kosync-step">
        <span class="kosync-step-number">Step 2:</span>
        Extract <span class="kosync-code">cwasync.koplugin.zip</span> directly to your device's
        <span class="kosync-code">/koreader/plugins/</span> folder. This will create the
        <span class="kosync-code">cwasync.koplugin</span> folder with all the plugin files.
      </div>

      <div class="kosync-warning">
        <strong>Important:</strong> Extract the zip file directly to the <code>/koreader/plugins/</code> directory.
        The extraction will automatically create the <code>cwasync.koplugin</code> folder with the correct structure.
      </div>
    </div>

    <div class="kosync-section">
      <h3>‚öôÔ∏è Enabling the Plugin in KOReader</h3>

      <div class="kosync-step">
        <span class="kosync-step-number">Step 1:</span>
        Open KOReader on your device.
      </div>

      <div class="kosync-step">
        <span class="kosync-step-number">Step 2:</span>
        Tap the top menu area to bring up the navigation bar.
      </div>

      <div class="kosync-step">
        <span class="kosync-step-number">Step 3:</span>
        Navigate to: <strong>Settings</strong> ‚Üí <strong>Tools</strong> ‚Üí <strong>Plugin management</strong>
      </div>

      <div class="kosync-step">
        <span class="kosync-step-number">Step 4:</span>
        Find "CWA Sync" in the plugin list and enable it.
      </div>

      <div class="kosync-step">
        <span class="kosync-step-number">Step 5:</span>
        Configure the sync settings:
        <ul style="margin-top: 10px;">
          <li><strong>Server URL:</strong> <span class="kosync-code">{{ request.host_url }}kosync</span></li>
          <li><strong>Username:</strong> Your Calibre-Web-Automated username</li>
          <li><strong>Password:</strong> Your Calibre-Web-Automated password</li>
        </ul>
      </div>

      <div class="kosync-step">
        <span class="kosync-step-number">Step 6:</span>
        Restart KOReader to activate the plugin.
      </div>
    </div>

    <div class="kosync-section">
      <h3>üîÑ Using the Sync Feature</h3>

      <div class="kosync-info">
        Once configured, the plugin will automatically sync your reading progress in the background.
        Your progress will be saved when you:
        <ul style="margin-top: 10px;">
          <li>Turn pages</li>
          <li>Close a book</li>
          <li>Switch between books</li>
          <li>Exit KOReader</li>
        </ul>
      </div>

      <div class="kosync-warning">
        <strong>Note:</strong> Make sure you have an internet connection for the sync to work.
        The plugin will automatically retry failed sync attempts when connectivity is restored.
      </div>
    </div>

    <div class="kosync-section">
      <h3>‚ùì Troubleshooting</h3>

      <div class="kosync-step">
        <span class="kosync-step-number">Issue:</span>
        Plugin not appearing in KOReader
        <br>
        <strong>Solution:</strong> Ensure the folder structure is correct and restart KOReader completely.
      </div>

      <div class="kosync-step">
        <span class="kosync-step-number">Issue:</span>
        Authentication failed
        <br>
        <strong>Solution:</strong> Double-check your username and password. Make sure you're using your correct credentials.
      </div>

      <div class="kosync-step">
        <span class="kosync-step-number">Issue:</span>
        Sync not working
        <br>
        <strong>Solution:</strong> Check your internet connection and verify the server URL is correct.
      </div>
    </div>
  </div>
</div>
{% endblock %}
